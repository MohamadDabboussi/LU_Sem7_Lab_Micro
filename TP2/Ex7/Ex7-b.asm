OUT EQU 0
WAIT EQU 1
DEPLACEMENT EQU 2
FINISHAT EQU 3
NEXT EQU 4
X_C EQU 0
Y_C EQU 2
COM EQU 4
DRAWPAD EQU $E020
A EQU 50
B EQU 100
C EQU 150

 ORG $2000
S1 DC.B $04 ; OUTPUT
   DC.B $00 ; WAIT TIME
   DC.B $00 ; DEPLACEMENT
   DC.B A   ; FINISH AT
   DC.W S2
S2 DC.B $80 ; OUTPUT
   DC.B $02 ; WAIT TIME
   DC.B $0A ; DEPLACEMENT
   DC.B C   ; FINISH AT
   DC.W S3
S3 DC.B $01 ; OUTPUT
   DC.B $10 ; WAIT TIME
   DC.B $00 ; DEPLACEMENT
   DC.B C   ; FINISH AT
   DC.W S4
S4 DC.B $40 ; OUTPUT
   DC.B $02 ; WAIT TIME
   DC.B $F6 ; DEPLACEMENT
   DC.B B   ; FINISH AT
   DC.W S5
S5 DC.B $02 ; OUTPUT
   DC.B $06 ; WAIT TIME
   DC.B $00  ; DEPLACEMENT
   DC.B B   ; FINISH AT
   DC.W S6
S6 DC.B $40 ; OUTPUT
   DC.B $02 ; WAIT TIME
   DC.B $F6 ; DEPLACEMENT
   DC.B A   ; FINISH AT
   DC.W S1
STATEPT DS.W 1 ; STATE POINTER

 ORG $1000 ; MAIN PROGRAM
 MOVEA.L #S1,A0
 MOVE.W A0,STATEPT
 Move.w #A,A2
FSM
 MOVEA.W STATEPT,A0
 Move.B OUT(A0),$E003
 CMP.W #$2000,A0
 BEQ WAITSTART
CONTINUE
 Move.W #$0000,$E024
 Move.B DEPLACEMENT(A0),D2
 Move.B FINISHAT(A0),D3
 ADD.B D2,A2
 Move.W A2,D1
 and.w #$00FF,D1
 LEA DRAWPAD,A1
 MOVE.W #60,X_C(A1)
 MOVE.W #150,Y_C(A1)
 MOVE.W #$0008,COM(A1)
 MOVE.W #$C143,COM(A1)
 MOVE.W #110,X_C(A1)
 MOVE.W #$0008,COM(A1)
 MOVE.W #$C243,COM(A1)
 MOVE.W #160,X_C(A1)
 MOVE.W #$0008,COM(A1)
 MOVE.W #$C343,COM(A1)
 MOVE.W D1,X_C(A1)
 MOVE.W #100,Y_C(A1)
 MOVE.W #$0008,COM(A1)
 ADD.W #40,D1
 MOVE.W D1,X_C(A1)
 MOVE.W #120,Y_C(A1)
 MOVE.W #$2772,COM(A1)
 MOVE.B WAIT(A0),D0
 BSR DELAY
 MOVE.w A2,D2
 and.w #$00FF,D2
 CMP.W D2,D3
 bne CONTINUE
 MOVE.W NEXT(A0),STATEPT
 BRA FSM

WAITSTART
 Move.w #A,A2
 Move.B $E001,D2
 btst #03,D2
 beq WAITSTART
 bra CONTINUE

DELAY ; TIME = D0 SECOND
 CMP.B #0,D0
 BEQ FIN
 MOVE.L #$FFD00000,D2
LOOP
 ADD.L #$01,D2
 BNE LOOP
 ADD.L #$FFFFFFFF,D0
 BNE DELAY
FIN
 RTS
 END $1000